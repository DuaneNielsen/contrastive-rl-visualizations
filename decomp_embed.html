<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vector Decomposition: ψ = c·z + ζ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: #0a0a0f;
            color: #e0e0e0;
            overflow: hidden;
        }
        #container {
            display: grid;
            grid-template-rows: 1fr auto;
            height: 100vh;
            width: 100vw;
        }
        #canvas-container {
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        canvas {
            max-width: 100%;
            max-height: 100%;
        }
        #controls {
            background: #12121a;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            border-top: 1px solid #2a2a3a;
        }
        .control-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        label {
            font-size: 0.8em;
            color: #aaa;
            white-space: nowrap;
        }
        input[type="range"] {
            width: 100px;
            accent-color: #88ccff;
        }
        .value {
            font-family: monospace;
            font-size: 0.8em;
            color: #88ccff;
            min-width: 45px;
        }
        button {
            padding: 6px 12px;
            background: #3a5a8a;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-size: 0.8em;
        }
        button:hover { background: #4a7aaa; }
        .equation {
            font-family: 'Times New Roman', serif;
            font-size: 1em;
            color: #ffcc00;
            padding: 4px 10px;
            background: rgba(255,204,0,0.1);
            border-radius: 4px;
        }
        .constraint {
            font-family: monospace;
            font-size: 0.75em;
            color: #88ccff;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="canvas-container">
            <canvas id="canvas"></canvas>
        </div>
        <div id="controls">
            <div class="equation">ψ = c·z + ζ</div>
            <div class="control-group">
                <label>c</label>
                <input type="range" id="c-slider" min="0" max="2" step="0.01" value="1.0">
                <span class="value" id="c-val">1.00</span>
            </div>
            <div class="control-group">
                <label>||ζ||</label>
                <input type="range" id="zeta-slider" min="0" max="2" step="0.01" value="0.5">
                <span class="value" id="zeta-val">0.50</span>
            </div>
            <div class="constraint">c'²+||ζ'||²=<span id="sum">1.00</span></div>
            <button id="animate-btn">▶ Animate</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        function resize() {
            const container = document.getElementById('canvas-container');
            const size = Math.min(container.clientWidth, container.clientHeight) - 20;
            canvas.width = size;
            canvas.height = size;
            draw();
        }

        window.addEventListener('resize', resize);

        let cRaw = 1.0;
        let zetaRaw = 0.5;
        let isAnimating = false;

        function draw() {
            const w = canvas.width;
            const h = canvas.height;
            const cx = w / 2;
            const cy = h / 2;
            const scale = Math.min(w, h) * 0.35;

            ctx.clearRect(0, 0, w, h);

            // Normalize
            const mag = Math.sqrt(cRaw * cRaw + zetaRaw * zetaRaw);
            const cNorm = mag > 0 ? cRaw / mag : 0;
            const zetaNorm = mag > 0 ? zetaRaw / mag : 0;

            // Update UI
            document.getElementById('c-val').textContent = cNorm.toFixed(2);
            document.getElementById('zeta-val').textContent = zetaNorm.toFixed(2);
            document.getElementById('sum').textContent = (cNorm * cNorm + zetaNorm * zetaNorm).toFixed(2);

            // Grid
            ctx.strokeStyle = '#1a1a2a';
            ctx.lineWidth = 1;
            for (let i = -2; i <= 2; i += 0.5) {
                ctx.beginPath();
                ctx.moveTo(cx + i * scale, 0);
                ctx.lineTo(cx + i * scale, h);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(0, cy - i * scale);
                ctx.lineTo(w, cy - i * scale);
                ctx.stroke();
            }

            // Unit circle
            ctx.beginPath();
            ctx.arc(cx, cy, scale, 0, Math.PI * 2);
            ctx.strokeStyle = '#445566';
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.fillStyle = 'rgba(68, 85, 102, 0.1)';
            ctx.fill();

            // Goal axis (yellow, up)
            drawArrow(cx, cy, cx, cy - 1.25 * scale, '#ffcc00', 2.5);
            ctx.fillStyle = '#ffcc00';
            ctx.font = 'bold 13px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('goal (z)', cx, cy - 1.25 * scale - 8);

            // Zeta axis (cyan, right)
            drawArrow(cx, cy, cx + 1.25 * scale, cy, '#00ccff', 2.5);
            ctx.fillStyle = '#00ccff';
            ctx.textAlign = 'left';
            ctx.fillText('ζ', cx + 1.25 * scale + 5, cy + 4);

            // Psi position
            const psiX = cx + zetaNorm * scale;
            const psiY = cy - cNorm * scale;

            // c component (yellow bar)
            if (Math.abs(cNorm) > 0.01) {
                ctx.strokeStyle = 'rgba(255, 204, 0, 0.6)';
                ctx.lineWidth = 6;
                ctx.lineCap = 'round';
                ctx.beginPath();
                ctx.moveTo(cx, cy);
                ctx.lineTo(cx, cy - cNorm * scale);
                ctx.stroke();
            }

            // zeta component (cyan bar)
            if (Math.abs(zetaNorm) > 0.01) {
                ctx.strokeStyle = 'rgba(0, 204, 255, 0.6)';
                ctx.lineWidth = 6;
                ctx.beginPath();
                ctx.moveTo(cx, cy - cNorm * scale);
                ctx.lineTo(psiX, psiY);
                ctx.stroke();
            }

            // Dashed guides
            ctx.setLineDash([3, 3]);
            ctx.strokeStyle = 'rgba(255,255,255,0.15)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(psiX, psiY);
            ctx.lineTo(psiX, cy);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(psiX, psiY);
            ctx.lineTo(cx, psiY);
            ctx.stroke();
            ctx.setLineDash([]);

            // Psi vector (pink)
            drawArrow(cx, cy, psiX, psiY, '#ff6688', 2.5);

            // Psi endpoint
            ctx.beginPath();
            ctx.arc(psiX, psiY, 7, 0, Math.PI * 2);
            ctx.fillStyle = '#ff6688';
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Labels
            ctx.font = '12px Arial';
            ctx.fillStyle = '#ff6688';
            ctx.textAlign = 'left';
            ctx.fillText('ψ(s)', psiX + 10, psiY - 5);

            if (Math.abs(cNorm) > 0.15) {
                ctx.fillStyle = '#ffcc00';
                ctx.textAlign = 'right';
                ctx.fillText(`c'=${cNorm.toFixed(2)}`, cx - 6, cy - cNorm * scale / 2 + 4);
            }
            if (Math.abs(zetaNorm) > 0.15) {
                ctx.fillStyle = '#00ccff';
                ctx.textAlign = 'center';
                ctx.fillText(`ζ'=${zetaNorm.toFixed(2)}`, cx + zetaNorm * scale / 2, cy - cNorm * scale - 8);
            }
        }

        function drawArrow(x1, y1, x2, y2, color, lw) {
            const headLen = 10;
            const angle = Math.atan2(y2 - y1, x2 - x1);
            ctx.strokeStyle = color;
            ctx.fillStyle = color;
            ctx.lineWidth = lw;
            ctx.lineCap = 'round';
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x2, y2);
            ctx.lineTo(x2 - headLen * Math.cos(angle - Math.PI / 6), y2 - headLen * Math.sin(angle - Math.PI / 6));
            ctx.lineTo(x2 - headLen * Math.cos(angle + Math.PI / 6), y2 - headLen * Math.sin(angle + Math.PI / 6));
            ctx.closePath();
            ctx.fill();
        }

        document.getElementById('c-slider').addEventListener('input', (e) => {
            cRaw = parseFloat(e.target.value);
            draw();
        });
        document.getElementById('zeta-slider').addEventListener('input', (e) => {
            zetaRaw = parseFloat(e.target.value);
            draw();
        });

        let animId = null;
        document.getElementById('animate-btn').addEventListener('click', () => {
            if (isAnimating) {
                isAnimating = false;
                document.getElementById('animate-btn').textContent = '▶ Animate';
                return;
            }
            isAnimating = true;
            document.getElementById('animate-btn').textContent = '⏹ Stop';
            cRaw = 1.0;
            zetaRaw = 0.2;

            function animate() {
                if (!isAnimating) return;
                zetaRaw += 0.012;
                cRaw = 1.0 + 0.2 * Math.sin(zetaRaw * 0.5);
                document.getElementById('c-slider').value = Math.min(2, cRaw);
                document.getElementById('zeta-slider').value = Math.min(2, zetaRaw);
                draw();
                if (zetaRaw > 2.5) { zetaRaw = 0.2; cRaw = 1.0; }
                animId = requestAnimationFrame(animate);
            }
            animate();
        });

        resize();
    </script>
</body>
</html>
